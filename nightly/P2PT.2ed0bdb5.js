!function(e,t,r,n,o){var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},c="function"==typeof s[n]&&s[n],i=c.cache||{},p="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function l(t,r){if(!i[t]){if(!e[t]){var o="function"==typeof s[n]&&s[n];if(!r&&o)return o(t,!0);if(c)return c(t,!0);if(p&&"string"==typeof t)return p(t);var a=Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}d.resolve=function(r){var n=e[t][1][r];return null!=n?n:r},d.cache={};var u=i[t]=new l.Module(t);e[t][0].call(u.exports,d,u,u.exports,this)}return i[t].exports;function d(e){var t=d.resolve(e);return!1===t?{}:l(t)}}l.isParcelRequire=!0,l.Module=function(e){this.id=e,this.bundle=l,this.exports={}},l.modules=e,l.cache=i,l.parent=c,l.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(l,"root",{get:function(){return s[n]}}),s[n]=l;for(var a=0;a<t.length;a++)l(t[a])}({eFFHh:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"Sync",(function(){return _}));var o=e("@swc/helpers/_/_async_to_generator"),s=e("@swc/helpers/_/_class_call_check"),c=e("@swc/helpers/_/_create_class"),i=e("@swc/helpers/_/_get"),p=e("@swc/helpers/_/_get_prototype_of"),l=e("@swc/helpers/_/_inherits"),a=e("@swc/helpers/_/_sliced_to_array"),u=e("@swc/helpers/_/_create_super"),d=e("@swc/helpers/_/_ts_generator"),h=e("../Base/index"),f=e("../Crypto"),_=function(e){(0,l._)(r,e);var t=(0,u._)(r);function r(){var e;return(0,s._)(this,r),(e=t.apply(this,arguments)).trackersAnnounceURLs=[],e.peers={},e.tokens={},e}return(0,c._)(r,[{key:"destroy",value:function(){var e;this.trackersAnnounceURLs=[],null===(e=this.p2pt)||void 0===e||e.destroy(),(0,i._)((0,p._)(r.prototype),"destroy",this).call(this)}},{key:"connect",value:function(e){var t=this,n=this;return(0,o._)((function(){return(0,d._)(this,(function(o){return(0,i._)((0,p._)(r.prototype),"connect",t).call(n,e),n.trackersAnnounceURLs=e.config||[],window.P2PT?n.init(!0):n.load(["https://cdn.jsdelivr.net/gh/subins2000/p2pt/dist/p2pt.umd.min.js",f.Crypto.url],n),[2]}))}))()}},{key:"init",value:function(e,t){if(0==this.trackersAnnounceURLs.length)return this.sendDisconnectError("You have to provide at least one WebTorrent tracker.");var r=this.uniqueID();if(e&&window.P2PT&&r){this.p2pt=new window.P2PT(this.trackersAnnounceURLs,r),f.Crypto.init(this.password);var n=this;this.p2pt.on("trackerconnect",(function(e,t){console.log("Connected to tracker : "+e.announceUrl),console.log("Tracker stats : "+JSON.stringify(t)),n.sendConnect()})),this.p2pt.on("peerconnect",(function(e){console.warn("Peer connected : "+e.id,e),n.peers[e.id]=e})),this.p2pt.on("peerclose",(function(e){console.warn("Peer disconnected : "+e);var t=n.tokens[e.id];t&&(n.db.removePeer(t),delete n.tokens[e.id]),delete n.peers[e.id]})),this.p2pt.on("msg",(function(e,t){if(console.warn("Got message from ".concat(e.id," : ").concat(t)),t)try{var r=(0,a._)(f.Crypto.decode(t),2),o=r[0],s=r[1];o==n.token||null==s||(n.applyUpdate(h.base64_to_unit8(s)),n.tokens[e.id]||(n.tokens[e.id]=o))}catch(e){console.warn("P2PT",e.message)}})),this.p2pt.start()}else{var o="P2PT unknown error";t?o="Could not load resource: "+t:window.P2PT||(o="Could not load P2PT interface"),this.sendDisconnectError(o)}}},{key:"broadcast",value:function(e){if(this.p2pt){var t=null==e?null:h.uint8_to_base64(e),r=f.Crypto.encode([this.token,t]);for(var n in this.peers)this.p2pt.send(this.peers[n],r)}}}]),r}(h.Sync)},{"@swc/helpers/_/_async_to_generator":"9nZrO","@swc/helpers/_/_class_call_check":"aKk2j","@swc/helpers/_/_create_class":"1kStN","@swc/helpers/_/_get":"eIgRj","@swc/helpers/_/_get_prototype_of":"cFXpH","@swc/helpers/_/_inherits":"cPJNz","@swc/helpers/_/_sliced_to_array":"gC503","@swc/helpers/_/_create_super":"4oibw","@swc/helpers/_/_ts_generator":"9rWj2","../Base/index":"5ZLLr","../Crypto":"kdUHg","@parcel/transformer-js/src/esmodule-helpers.js":"1NFta"}],kdUHg:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"Crypto",(function(){return o}));var o={url:"https://cdn.jsdelivr.net/npm/simple-crypto-js@2.5.0/dist/SimpleCrypto.min.js",crypt:null,check:function(){return!!window.SimpleCrypto},init:function(e){try{"string"==typeof e&&e.length>0?this.crypt=new SimpleCrypto(e):this.crypt=null}catch(e){console.warn("Crypto: ",e),this.crypt=null}},encode:function(e){return this.crypt?this.crypt.encrypt(btoa(encodeURIComponent(JSON.stringify(e)))):JSON.stringify(e)},decode:function(e){return this.crypt?JSON.parse(decodeURIComponent(atob(this.crypt.decrypt(e)))):JSON.parse(e)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"1NFta"}]},[],0,"parcelRequire55a5");
